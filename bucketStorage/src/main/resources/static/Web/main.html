<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Stay in Cloud: Main Page</title>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <img src="Stay-in-cloud.png" alt="Stay-in-Cloud Logo">
        <h1>Stay-in-Cloud: Media Page</h1>
        <br>
        <button onclick="window.location.href='home.html'">Back to Homepage</button>
        <div class="user-info">
            <strong>Username:</strong> <span id="username"></span>
        </div>
        <br><br>
        <div class="media-upload-section">
            <h2>Upload Media</h2>
            <form id="uploadForm">
                <label for="mediaFile">Select media to upload:</label>
                <input type="file" id="mediaFile" name="mediaFile" 
                accept=".pdf,.jpg,.jpeg,.png,.mp3,.mp4,.doc,.docx,.odt,.xls,.xlsx,.db,.ppt,.pptx">
                <br><br>
                <button type="submit">Upload</button>
            </form>
            <div id="upload-status">
                <!-- Upload status messages will appear here -->
            </div>
        </div>
        <div id="retrieve-media">
            <div class="list-media-in-storage">
                <h2>Media in OS bucket</h2>
                <button onclick="loadMediaList()">Refresh List</button>
                <ul id="mediaList">
                    <!-- List of media files will be populated here -->
                </ul>
            </div>
            <div class="media-download-section">
                <h2>Download Media</h2>
                <form id="downloadForm">
                    <label for="mediaFileName">Select media file to download:</label>
                    <select id="mediaFileName" name="mediaFileName" required>
                        <option value="" disabled selected>Select a file</option>
                        <!-- Add more options dynamically as needed -->
                    </select>
                    <br><br>
                <button type="submit">Download</button>
                </form>
                <div id="download-status"></div>
            </div>
        </div>
        <script>
            try {
                // Checking bucket availability
                async function initBucket() {
                    try {
                        const res = await fetch("/api/setBucket", { method: "PUT" });
                        const message = await res.text();
                        console.log(message);
                        document.getElementById("bucket-status").textContent = message;
                    } catch (err) {
                        console.error("Error initializing bucket:", err);
                    }
                }
                document.addEventListener("DOMContentLoaded", initBucket);
                //Listing Available objects
                const res = await fetch("/api/listmedia");
                if (!res.ok) throw new Error("Failed to fetch file list");
                const files = await res.json();

                const list = document.getElementById("mediaList");
                list.innerHTML = ""; // Clear current list
                files.forEach(file => {
                    const li = document.createElement("li");
                    li.textContent = file;
                    list.appendChild(li);
                });
            } catch (err) {
                console.error(err);
            }

            //list files before/after upload
            document.addEventListener("DOMContentLoaded", loadMediaList);
        </script>
    </body>
</html>